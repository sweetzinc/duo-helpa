# Language Selection Feature Implementation Plan

## Request:
I want to add a feature of selecting the target language from the UI. There should be a dropbown menu above the tabs. I want to be have German (default), French, Spanish and Italian support. How can we implement it? Please write your plan in PLAN.md

--- 

## Current State Analysis

The app currently supports configurable languages through environment variables:
- `TARGET_LANGUAGE` (default: German)
- `SOURCE_LANGUAGE` (default: English)
- Language configuration is loaded in `config.py:8-9`
- Language service uses these configs in `language_service.py:10-11`
- UI shows current target language in header at `app.py:57`

## Implementation Strategy

### 1. Extend Configuration (`config.py`)
- Add `SUPPORTED_LANGUAGES` constant with language options
- Add `DEFAULT_TARGET_LANGUAGE` for initial UI state
- Keep existing environment variable support for deployment flexibility

### 2. Enhance Language Service (`language_service.py`)
- Add `set_target_language()` method to allow runtime language switching
- Update all prompt templates to use dynamic language references
- Ensure thread safety for language changes during active requests

### 3. Update UI (`app.py`)
- Add language selection dropdown above tabs (before line 59)
- Create dropdown with options: German (default), French, Spanish, Italian
- Connect dropdown to callback function that updates language service
- Update header text to reflect selected language dynamically
- Update translation direction dropdown when target language changes

### 4. Implementation Details

#### Language Dropdown Component
```python
language_dropdown = gr.Dropdown(
    choices=["German", "French", "Spanish", "Italian"],
    value="German",
    label="Target Language",
    info="Select the language you want to learn"
)
```

#### Callback Function
- Create `on_language_change(new_language)` handler
- Update `language_service.target_language`
- Refresh translation direction options
- Update header text

#### UI Layout Changes
- Position dropdown above tabs for prominence
- Maintain mobile-friendly design
- Ensure dropdown state persists during session

### 5. Files to Modify
1. `config.py` - Add language constants
2. `language_service.py` - Add language switching capability  
3. `app.py` - Add dropdown UI and event handlers

### 6. Technical Considerations
- Session state management for selected language
- Gradio state updates for dependent components
- No database persistence needed (session-based)
- Backward compatibility with environment variables

### 7. Testing Approach
- Verify each language selection works correctly
- Test word lookup in both directions for each language
- Test grammar correction for each language
- Ensure UI updates properly reflect language changes